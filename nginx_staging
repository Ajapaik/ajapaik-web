server {
        listen 80;
        server_name staging.ajapaik.ee;
        return 301 https://staging.ajapaik.ee$request_uri;
}

server {
        listen 443;
        ssl on;
        server_name staging.ajapaik.ee;

        ssl_certificate /var/garage/staging_cert/1_ajapaik.ee_bundle.crt;
        ssl_certificate_key /var/garage/staging_cert/ajapaik_startssl_csr.key;

        access_log /dev/null;
        error_log /dev/null;

        location /cat/v1/albums/ {
                proxy_pass http://sift.pics:9010/cat/v1/albums/;
                proxy_redirect off;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /media  {
                alias /var/garage/rephoto_staging/media;
        }

        location /static {
                alias /var/garage/rephoto_staging/static-collected;
        }

        location / {
                include uwsgi_params;
                uwsgi_pass unix:/var/garage/run/staging_ajapaik_ee.sock;
        }
}
