!function(e){"use strict";"function"==typeof define&&define.amd?define(["load-image"],e):e(window.loadImage)}(function(I){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var p=I.renderImageToCanvas;I.detectSubsampling=function(e){var t,a;return 1048576<e.width*e.height&&((t=document.createElement("canvas")).width=t.height=1,(a=t.getContext("2d")).drawImage(e,1-e.width,0),0===a.getImageData(0,0,1,1).data[3])},I.detectVerticalSquash=function(e,t){var a,n,i,r,d=e.naturalHeight||e.height,o=document.createElement("canvas"),g=o.getContext("2d");for(t&&(d/=2),o.width=1,o.height=d,g.drawImage(e,0,0),a=g.getImageData(0,0,1,d).data,n=0,r=i=d;n<r;)0===a[4*(r-1)+3]?i=r:n=r,r=i+n>>1;return r/d||1},I.renderImageToCanvas=function(e,t,a,n,i,r,d,o,g,c){if("image/jpeg"===t._type){var m,h,u,f,w=e.getContext("2d"),s=document.createElement("canvas"),l=1024,v=s.getContext("2d");if(s.width=l,s.height=l,w.save(),(m=I.detectSubsampling(t))&&(a/=2,n/=2,i/=2,r/=2),h=I.detectVerticalSquash(t,m),m||1!==h){for(n*=h,g=Math.ceil(l*g/i),c=Math.ceil(l*c/r/h),f=o=0;f<r;){for(u=d=0;u<i;)v.clearRect(0,0,l,l),v.drawImage(t,a,n,i,r,-u,-f,i,r),w.drawImage(s,0,0,l,l,d,o,g,c),u+=l,d+=g;f+=l,o+=c}return w.restore(),e}}return p(e,t,a,n,i,r,d,o,g,c)}}});