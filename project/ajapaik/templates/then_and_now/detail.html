{% extends "then_and_now/base.html" %}

{% load static compress i18n %}

{% block content %}
    <div class="container-fluid">
        <div class="col-xs-12">
            <div class="row tan-text-center">
                <div class="col-xs-12 col-sm-{% if rephoto %}6{% else %}12{% endif %}">
                    <div id="tan-detail-image-container">
                        <img class="img-responsive" id="tan-detail-image" src="{% url 'project.ajapaik.views.image_thumb' photo.pk 800 %}">
                        {% if previous_photo %}
                            <a class="tan-image-overlay-button" id="tan-detail-prev-button"
                               title="{% trans "Previous photo" %}"
                               href="{% url "project.ajapaik.then_and_now_tours.detail" tour.id previous_photo.id %}">
                                <i class="material-icons">navigate_before</i>
                            </a>
                        {% endif %}
                        {% if next_photo %}
                            <a class="tan-image-overlay-button" id="tan-detail-next-button"
                               title="{% trans "Next photo" %}"
                               href="{% url "project.ajapaik.then_and_now_tours.detail" tour.id next_photo.id %}">
                                <i class="material-icons">navigate_next</i>
                            </a>
                        {% endif %}
                    </div>
                    <div class="row">
                        {{ photo.description }}
                    </div>
                    <div class="row">
                        <form id="form" action="/then-and-now-tours/camera/upload/" method="post" enctype="multipart/form-data">
                            <input name="image" id="camera-file-capture" type="file" accept="image/*" onchange="PreviewImage();"
                                   capture="camera"/>
                            <img style="display:none" id="uploadPreview" class="img-responsive"/>
                            <input type="hidden" name="original" value="{{ photo.id }}"/>
                            <input type="hidden" name="tour" value="{{ tour.id }}"/>
                        </form>
                        <span class="glyphicon glyphicon-camera tan-font-size-48px" aria-hidden="true"></span>
                        <span style="display:none" class="glyphicon glyphicon-ok tan-font-size-48px" aria-hidden="true"></span>
                    </div>
                </div>
                {% if rephoto %}
                    <div class="col-xs-12 col-sm-6">
                        <div id="tan-detail-rephoto-container">
                            <img class="img-responsive" src="{% url 'project.ajapaik.then_and_now_tours.rephoto_thumb' rephoto.pk 800 photo.get_pseudo_slug %}">
                            <a class="tan-image-overlay-button" id="tan-detail-rephoto-close-button"
                               title="{% trans "Close rephoto" %}"
                               href="{% url "project.ajapaik.then_and_now_tours.detail" tour.id photo.id %}">
                                <i class="material-icons">close</i>
                            </a>
                            {% if previous_rephoto %}
                                <a class="tan-image-overlay-button" id="tan-detail-rephoto-prev-button"
                                   title="{% trans "Previous rephoto" %}"
                                   href="{% url "project.ajapaik.then_and_now_tours.detail" tour.id photo.id previous_rephoto.pk %}">
                                    <i class="material-icons">navigate_before</i>
                                </a>
                            {% endif %}
                            {% if next_rephoto %}
                                <a class="tan-image-overlay-button" id="tan-detail-rephoto-next-button"
                                   title="{% trans "Next rephoto" %}"
                                   href="{% url "project.ajapaik.then_and_now_tours.detail" tour.id photo.id next_rephoto.id %}">
                                    <i class="material-icons">navigate_next</i>
                                </a>
                            {% endif %}
                        </div>
                        <div class="row">
                            {% trans "Rephoto"%}: {% if rephoto.user.user.first_name and rephoto.user.user.last_name %}
                                {{ rephoto.user.user.first_name }} {{ rephoto.user.user.last_name }}
                            {% else %}
                                {% trans "Anonymous user" %}
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="col-xs-12">
            {% for rp in rephotos %}
                <div class="col-xs-6 col-sm-4 col-md-3">
                    <a href="{% url 'project.ajapaik.then_and_now_tours.detail' tour.pk photo.pk rp.pk %}"
                       class="thumbnail{% if rp == rephoto %} active{% endif %}">
                        <img src="{% url 'project.ajapaik.then_and_now_tours.rephoto_thumb' rp.pk photo.get_pseudo_slug %}"
                             alt="{% trans "Rephoto of" %} {{ photo.description }}">
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block specific_js %}
    {% compress js %}
        <script src="{% static 'js/hammer-2.0.4.js' %}"></script>
        <script src="{% static 'js/then-and-now-detail.js' %}"></script>
    {% endcompress %}
{% endblock %}