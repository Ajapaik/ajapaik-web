{% load i18n cache thumbnail compress ajapaik_templatetags static %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}" {% if is_game or is_mapview or is_test_geotagger or is_tag %} class="ajapaik-html-game-map"{% endif %}
      prefix="fb: http://www.facebook.com/2008/fbml">
<head>
    <title>
        {% if title %}
            {{ title }} - {% trans "Timepatch (Ajapaik)" %}
        {% else %}
            {% trans "Timepatch (Ajapaik)" %}
        {% endif %}
    </title>
    <meta name="description" content="
        {% if is_frontpage %}
            {% if album %}
                {% trans 'Gallery of old historic photos from the album' %} {{ album.1 }}
            {% else %}
                {% trans 'Historic photo gallery' %}
            {% endif %}
        {% elif is_mapview %}
            {% if album %}
                {% trans 'Mapped old historic photos from the album' %} {{ album.1 }}
            {% else %}
                {% trans 'Mapped old historic photos' %}
            {% endif %}
        {% elif is_game %}
            {% if album %}
                {% trans 'Help geotag old historic photos from the album' %} {{ album.1 }}
            {% else %}
                {% trans 'Help geotag old historic photos' %}
            {% endif %}
        {% elif is_photoview %}
            {% if rephoto %}
                {% trans 'Before and after view of' %} {{ rephoto.description }}
            {% elif photo %}
                {% trans 'Historic photo of' %} {{ photo.description }}
            {% endif %}
        {% elif is_curator%}
            {% trans 'Curate historic photos from museums into Ajapaik for geotagging and rephotographing' %}
        {% else %}
            {% trans 'Ajapaik shows how places have changed over time' %}
        {% endif %}
        ">
    <meta name="keywords" content="
        {% if is_frontpage %}
            {% if album %}
                {% trans 'historic,pictures,old,photos' %},{{ album.2 }}
            {% else %}
                {% trans 'historic,pictures,old,photos' %}
            {% endif %}
        {% elif is_mapview %}
            {% if album %}
                {% trans 'historic,pictures,old,photos,map,geotagged,location' %},{{ album.4 }}
            {% else %}
                {% trans 'historic,pictures,old,photos,map,geotagged,location' %}
            {% endif %}
        {% elif is_game %}
            {% if album %}
                {% trans 'historic,pictures,old,photos,crowd-sourced,geotagging,game' %},{{ album.4 }}
            {% else %}
                {% trans 'historic,pictures,old,photos,crowd-sourced,geotagging,game' %}
            {% endif %}
        {% elif is_photoview %}
            {% if rephoto %}
                {% trans 'historic,picture,old,photo,before,after' %},{{ rephoto.tags }}
            {% elif photo %}
                {% trans 'historic,picture,old,photo' %},{{ photo.tags }}
            {% endif %}
        {% elif is_curator %}
            {% trans 'search,museum,old,photos,pictures,historic' %}
        {% else %}
            {% trans 'historic,pictures,old,photos' %}
        {% endif %}
        ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="google-site-verification" content="3iK84Lw7RU9toVzSgoxDH4ErYxgkaoE4jrFMEb9R4Is"/>
    <meta property="fb:app_id" content="201052296573134"/>
    <meta name="msApplication-ID" content="Ajapaik.Ajapaik"/>
    <meta name="msApplication-PackageFamilyName" content="Ajapaik.Ajapaik_a85z4fx5ppqzw"/>
    <meta name="msApplication-MinVersion" content="1.0.0.8"/>
    <meta name="application-name" content="Ajapaik"/>
    <meta name="msapplication-TileColor" content="#FFFFFF"/>
    <meta name="msapplication-notification" content="frequency=30;polling-uri=http://notifications.buildmypinnedsite.com/?feed=http://ajapaik.ee/feed/photos/&amp;id=1;polling-uri2=http://notifications.buildmypinnedsite.com/?feed=http://ajapaik.ee/feed/photos/&amp;id=2;polling-uri3=http://notifications.buildmypinnedsite.com/?feed=http://ajapaik.ee/feed/photos/&amp;id=3;polling-uri4=http://notifications.buildmypinnedsite.com/?feed=http://ajapaik.ee/feed/photos/&amp;id=4;polling-uri5=http://notifications.buildmypinnedsite.com/?feed=http://ajapaik.ee/feed/photos/&amp;id=5; cycle=1"/>
    <meta charset="UTF-8"/>
    {% if title %}
        <meta property="og:title" content="{{ title }}"/>
        {% if description %}
            <meta property="og:description" content="{{ description }}"/>
        {% elif not description and is_game and album %}
            <meta property="og:description" content="{% blocktrans with album_photo_count as album_photo_count %}Album has {{ album_photo_count }} historic pictures. Let's put pictures on the map!{% endblocktrans %}"/>
        {% elif not description and is_game %}
            <meta property="og:description" content="{% trans "Let's put pictures on the map" %}"/>
        {% elif not description and is_mapview %}
            <meta property="og:description" content="
                {% blocktrans count counter=total_photo_count %}
                    Album has {{ counter }} photo,
                {% plural %}
                    Album has {{ counter }} photos,
                {% endblocktrans %}
                {% blocktrans count counter=geotagging_user_count %}
                    {{ counter }} user has put
                {% plural %}
                    {{ counter }} users have put
                {% endblocktrans %}
                {% if total_photo_count == geotagged_photo_count %}
                    {% trans "all the pictures on the map." %}
                {% else %}
                    {% blocktrans count counter=geotagged_photo_count %}
                        {{ counter }} picture on the map.
                    {% plural %}
                        {{ counter }} pictures on the map.
                    {% endblocktrans %}
                {% endif %}
            "/>
        {% endif %}
        <meta property="og:type" content="website"/>
        {% if photo or rephoto %}
            {% if photo and is_frontpage %}
                <meta property="og:url" content="{{ hostname }}?photo={{ photo.0 }}"/>
            {% elif not photo and rephoto and is_frontpage %}
                <meta property="og:url" content="{{ hostname }}?photo={{ rephoto.rephoto_of.id }}"/>
            {% else %}
                {% if is_photoview and not rephoto %}
                    <meta property="og:url" content="{{ hostname }}/foto/{{ photo.id }}/"/>
                {% elif is_photoview and rephoto %}
                    <meta property="og:url" content="{{ hostname }}/foto/{{ rephoto.id }}/"/>
                {% else %}
                    <meta property="og:url" content="{{ hostname }}{{ request.path }}"/>
                {% endif %}
            {% endif %}
        {% elif selected_photo %}
            <meta property="og:url" content="{{ hostname }}{% url 'project.ajapaik.views.mapview' %}photo/{{ selected_photo.id }}/"/>
        {% elif album %}
            {% if is_mapview %}
                <meta property="og:url" content="{{ hostname }}{% url 'project.ajapaik.views.mapview' %}?album={{ album.0 }}"/>
            {% elif is_frontpage %}
                {% if album %}
                    <meta property="og:url" content="{{ hostname }}{% url 'project.ajapaik.views.frontpage' %}?album={{ album.0 }}"/>
                {% else %}
                    <meta property="og:url" content="{{ hostname }}{% url 'project.ajapaik.views.frontpage' %}"/>
                {% endif %}
            {% else %}
                 <meta property="og:url" content="{{ hostname }}{% url 'project.ajapaik.views.game' %}?album={{ album.0 }}"/>
            {% endif %}
        {% else %}
            <meta property="og:url" content="{{ hostname }}{{ request.path }}"/>
        {% endif %}
        {% if selected_photo %}
            <meta property="og:image" content="{{ hostname }}{% url 'project.ajapaik.views.photo_large' selected_photo.id %}"/>
            <meta property="og:image:width" content="{{ selected_photo.width }}" />
            <meta property="og:image:height" content="{{ selected_photo.height }}" />
        {% else %}
            {% if rephoto %}
                {% thumbnail rephoto.image "800x600" as im %}
                    <meta property="og:image" content="{{ hostname }}{{ im.url }}"/>
                    <meta property="og:image:type" content="image/jpeg"/>
                    <meta property="og:image:width" content="{{ im.width }}" />
                    <meta property="og:image:height" content="{{ im.height }}" />
                {% endthumbnail %}
            {% else %}
                {% if photo %}
                    {% thumbnail photo.image "800x600" as im %}
                        <meta property="og:image" content="{{ hostname }}{{ im.url }}"/>
                        <meta property="og:image:type" content="image/jpeg"/>
                        <meta property="og:image:width" content="{{ im.width }}" />
                        <meta property="og:image:height" content="{{ im.height }}" />
                    {% endthumbnail %}
                {% endif %}
            {% endif %}
            {% if facebook_share_photos %}
                {% for p in facebook_share_photos %}
                    <meta property="og:image" content="{{ hostname }}{% url 'project.ajapaik.views.photo_large' p.0 %}"/>
                    <meta property="og:image:width" content="{{ p.1 }}" />
                    <meta property="og:image:height" content="{{ p.2 }}" />
                {% endfor %}
            {% endif %}
            {% if curator_random_images %}
                {% for each in curator_random_images %}
                    <meta property="og:image" content="{{ hostname }}{% url 'project.ajapaik.views.photo_large' each.id %}"/>
                    <meta property="og:image:width" content="{{ each.width }}" />
                    <meta property="og:image:height" content="{{ each.height }}" />
                {% endfor %}
            {% endif %}
        {% endif %}
        <meta property="og:locale" content="et_EE"/>
        <meta property="og:locale:alternate" content="ru_RU"/>
        <meta property="og:locale:alternate" content="en_US"/>
        <meta property="og:site_name" content="{% trans "Timepatch (Ajapaik)" %}"/>
    {% endif %}
    <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="shortcut icon" type="image/ico" href="{{ STATIC_URL }}images/favicon.ico"/>
    <link rel="apple-touch-icon" href="{{ STATIC_URL }}images/ajapaik_marker_57px.png"/>
    <link rel="alternate" type="application/atom+xml" title="Ajapaik (FeedBurner)" href="http://feeds.ajapaik.ee/Ajapaik"/>
    <link rel="alternate" type="application/atom+xml" title="Ajapaik (API)" href="http://ajapaik.ee/feed/photos/"/>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
{#    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">#}
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.css">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.theme.min.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/icon?family=Material+Icons">
    {% compress css %}
        <link rel="stylesheet" href="{{ STATIC_URL }}libs/jQuery-File-Upload-9.9.2/css/jquery.fileupload.css">
        <link rel="stylesheet" href="{{ STATIC_URL }}libs/jQuery-File-Upload-9.9.2/css/jquery.fileupload-ui.css">
        <link rel="stylesheet" href="{{ STATIC_URL }}css/justifiedGallery-3.6.0.min.css"/>
        <link rel="stylesheet" href="{{ STATIC_URL }}libs/jsPanel-2.5.2/jspanel/jquery.jspanel.min.css"/>
        <link rel="stylesheet" href="{{ STATIC_URL }}css/ajapaik-style.css"/>
        <link rel="stylesheet" href="{{ STATIC_URL }}css/ajapaik-style-new.css"/>
    {% endcompress %}
    {% block specific_css %}{% endblock %}
    <script>
        var _gaq = _gaq || [];
        _gaq.push(["_setAccount", "{{ analytics.google_analytics_key }}"]);
        _gaq.push(["_trackPageview"]);
        (function () {
            var a = document.createElement("script");
            a.type = "text/javascript";
            a.async = !0;
            a.src = ("https:" == document.location.protocol ? "https://" : "http://") + "stats.g.doubleclick.net/dc.js";
            var b = document.getElementsByTagName("script")[0];
            b.parentNode.insertBefore(a, b)
        })();
    </script>
</head>
<body class="{% if is_game or is_mapview or is_test_geotagger or is_tag %}ajapaik-flex ajapaik-body-game-map{% endif %} {% if is_frontpage %}ajapaik-body-frontpage{% endif %}">
<div id="ajapaik-loading-overlay"></div>
<div id="fb-root"></div>
<form action="/i18n/setlang/" method="post" id="ajapaik-change-language-form">
    <input type="hidden" value="" name="language" id="ajapaik-language" />
    <input type="hidden" value="{{ request.get_full_path }}" name="next" />
    {% csrf_token %}
</form>
<div class="alert alert-danger" id="ajapaik-geolocation-error">
  <strong>{% trans "Geolocation error" %}:</strong> <span id="ajapaik-geolocation-error-message"></span>
</div>
<div class="alert alert-info" id="ajapaik-sorting-error">
  <strong>{% trans "Sorting" %}:</strong> <span id="ajapaik-sorting-error-message"></span>
</div>
{% include "_general_info_modal.html" %}
{% block header %}
    {% include "_header.html" %}
{% endblock header %}
{% block layout %}{% endblock layout %}
{% get_current_language as LANGUAGE_CODE %}
{% if LANGUAGE_CODE == 'et' and not request.mobile %}
    <div id="ajapaik-feedback-div" class="hidden-xs">
        <a id="ajapaik-feedback-link" href="https://goo.gl/1ZHEUy" target="_blank">{% trans "feedback" %}</a>
    </div>
{% endif %}
{% if is_frontpage or is_order %}
    <footer class="footer text-center">
        <div class="container-fluid">
            <div class="col-sm-3 hidden-xs" id="ajapaik-footer-contact">
                <div class="row">
                    <a class="pull-left" href="mailto:info@ajapaik.ee">info@ajapaik.ee</a>
                </div>
                <div class="row">
                    <a class="pull-left" id="ajapaik-photographic-heritage-link" target="_blank" href="http://fotopärand.org.ee/">{% trans "Estonian Photographic Heritage Society" %}</a>
                </div>
            </div>
            <nav>
                <ul class="pager col-xs-12 col-sm-6{% if not show_photos %} ajapaik-invisible{% endif %}" id="ajapaik-pager">
                    <li>
                        <a id="ajapaik-paging-previous-button" {% if page < 2 %}class="ajapaik-invisible"{% endif %} href="{% url 'project.ajapaik.views.frontpage' %}{% add_get page=page|add:-1 %}">
                            &lt;
                        </a>
                    </li>
                    <li class="disabled">
                        <a href="#" id="ajapaik-pager-stats">
                            {{ start|add:1 }} – {{ end }} / {{ total }}
                        </a>
                    </li>
                    <li>
                        <a id="ajapaik-paging-next-button" {% if page == max_page %}class="ajapaik-invisible"{% endif %} href="{% url 'project.ajapaik.views.frontpage' %}{% add_get page=page|add:1 %}">
                            &gt;
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="col-sm-3 hidden-xs" id="ajapaik-footer-links">
                <div class="row">
                    <a class="pull-right" id="ajapaik-sift-pics-link" target="_blank" href="http://sift.pics/">{% trans "See also – Sift.pics" %}</a>
                </div>
            </div>
        </div>
    </footer>
{% endif %}
{% block global_js %}
    <script>
        window.fbAsyncInit = function () {
            FB.init({appId: "201052296573134", status: !0, cookie: !0, xfbml: !0, version: 'v2.3'});
            try {
                FB.Event.subscribe("edge.create", function (a) {
                    _gaq.push(["_trackEvent", "Facebook", "Like added", a])
                }),
                FB.Event.subscribe("edge.remove", function (a) {
                    _gaq.push(["_trackEvent", "Facebook", "Like removed", a])
                }),
                FB.Event.subscribe("message.send", function (a) {
                    _gaq.push(["_trackEvent", "Facebook", "Message sent", a])
                }),
                FB.Event.subscribe("comment.create", function (a) {
                    _gaq.push(["_trackEvent", "Facebook", "Comment added", a.href]);
                    var parts = a.href.split('/');
                    $.post(window.updateCommentCountURL, {
                        photo_id: parts[parts.length - 2],
                        comment_id: a.commentID,
                        csrfmiddlewaretoken: window.docCookies.getItem('csrftoken')
                    }, function () {
                    });
                }),
                FB.Event.subscribe("comment.remove", function (a) {
                    _gaq.push(["_trackEvent", "Facebook", "Comment removed", a.href]);
                    var parts = a.href.split('/');
                    $.post(window.updateCommentCountURL, {
                        photo_id: parts[parts.length - 2],
                        comment_id: a.commentID,
                        csrfmiddlewaretoken: window.docCookies.getItem('csrftoken')
                    }, function () {
                    });
                }), FB.Event.subscribe("auth.prompt", function () {
                    _gaq.push(["_trackEvent", "Facebook", "Login prompt"])
                }), FB.Event.subscribe("auth.login", function () {
                    _gaq.push(["_trackEvent", "Facebook", "Login success"])
                }), FB.Event.subscribe("auth.logout", function () {
                    _gaq.push(["_trackEvent", "Facebook", "Logged out"])
                })
            } catch (b) {
                console.log(b)
            }
        };
        (function () {
            var b = document.createElement("script");
            b.async = !0;
            b.src = document.location.protocol + "//connect.facebook.net/{% if LANGUAGE_CODE == 'et' %}et_EE{% else %}{% if LANGUAGE_CODE == 'ru' %}ru_RU{% else %}en_US{% endif %}{% endif %}/sdk.js";
            document.getElementById("fb-root").appendChild(b)
        })();
    </script>
    <script>
        var isMobile = '{{ request.mobile }}',
            saveLocationURL = '{% url 'project.ajapaik.views.geotag_add' %}',
            confirmLocationURL = '{% url 'project.ajapaik.views.geotag_confirm' %}',
            updateCommentCountURL = '{% url 'project.ajapaik.views.update_comment_count' %}',
            leaderboardUpdateURL = '{% url 'project.ajapaik.views.leaderboard' %}',
            flipFeedbackURL = '{% url 'project.ajapaik.views.leaderboard' %}',
            allTimeLeaderboardURL = '{% url 'project.ajapaik.views.all_time_leaderboard' %}',
            leaderboardFullURL = '{% url 'project.ajapaik.views.top50' %}',
            photoSelectionURL = '{% url 'project.ajapaik.views.photo_selection' %}',
            isMapview = false,
            isGame = false,
            generalInfoModalURL = '{% url 'project.ajapaik.views.get_general_info_modal_content' %}',
            infoModalURL = '{% url 'project.ajapaik.views.get_album_info_modal_content' %}',
            lastGeotaggedPhotoId = '{{ last_geotagged_photo_id }}',
            userIsSocialConnected = false;
        isMobile = isMobile === 'True';
        {% if request.user.profile.fb_id %}
            userIsSocialConnected = true;
        {% elif request.user.profile.google_plus_id %}
            userIsSocialConnected = true;
        {% endif %}
    </script>
    {# TODO: We don't need tons of file upload stuff for the small rephoto upload windows, we certainly don't need moment.js, #}
    {# we probably don't need jquery-ui, if we rework these, we will no longer need datetimepicker, we don't need jsPanel #}
    {# just for showing the sidepanels in game and map mode #}
    {# we need to reduce the weight to accommodate mobile #}
    <script src="{% url 'django.views.i18n.javascript_catalog' %}?_={% now "U" %}"></script>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
    <script src="http://maps.google.com/maps/api/js?sensor=false&amp;v=3&amp;libraries=places,visualization"></script>
    {% compress js %}
        <script src="{{ STATIC_URL }}libs/bootstrap-datetimepicker-3.1.3/js/bootstrap-datetimepicker.min.js"></script>
        <script src="{{ STATIC_URL }}js/tmpl.min.js"></script>
        <script src="{{ STATIC_URL }}js/ajapaik-cookie.js"></script>
        <script src="{{ STATIC_URL }}js/jquery.justifiedGallery-3.6.0.min.js"></script>
        <script src="{{ STATIC_URL }}js/mobile-detect-0.4.3.min.js"></script>
        <script src="{{ STATIC_URL }}js/bigscreen-2.0.4.min.js"></script>
        <script src="{{ STATIC_URL }}js/jquery.bootstrap-autohidingnavbar-1.0.0.min.js"></script>
        <script src="{{ STATIC_URL }}js/lazysizes-1.2.0.min.js"></script>
        <script src="{{ STATIC_URL }}libs/jQuery-File-Upload-9.9.2/js/load-image.all-1.13.0.min.js"></script>
        <script src="{{ STATIC_URL }}libs/jQuery-File-Upload-9.9.2/js/canvas-to-blob.min.js"></script>
        <script src="{{ STATIC_URL }}libs/jQuery-File-Upload-9.9.2/js/jquery.iframe-transport.min.js"></script>
        <script src="{{ STATIC_URL }}libs/jQuery-File-Upload-9.9.2/js/jquery.fileupload.min.js"></script>
        <script src="{{ STATIC_URL }}libs/jQuery-File-Upload-9.9.2/js/jquery.fileupload-process.min.js"></script>
        <script src="{{ STATIC_URL }}libs/jQuery-File-Upload-9.9.2/js/jquery.fileupload-image.min.js"></script>
        <script src="{{ STATIC_URL }}libs/jQuery-File-Upload-9.9.2/js/jquery.fileupload-validate.min.js"></script>
        <script src="{{ STATIC_URL }}js/URI-1.15.1.min.js"></script>
        <script src="{{ STATIC_URL }}js/ajapaik-keyboard-controls.js"></script>
        <script src="{{ STATIC_URL }}js/ajapaik-common.js"></script>
        <script src="{{ STATIC_URL }}js/ajapaik-geotagger.js"></script>
        <script src="{% static "js/cookieconsent.min.js" %}"></script>
        <script type="text/javascript">
            window.cookieconsent_options = {
                message: '{% trans "This website uses cookies to ensure you get the best experience on our website" %}',
                dismiss: '{% trans "Got it!" %}',
                learnMore: '{% trans "More info" %}',
                link: null,
                theme: '{% static "css/cookieconsent.min.css" %}'
            };
        </script>
    {% endcompress %}
{% endblock %}
{% block specific_js %}{% endblock %}
</body>
</html>
