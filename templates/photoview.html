{% extends "base_bootstrap.html" %}
{% load thumbnail i18n %}

{% block layout %}
    <div class="container-fluid" id="ajapaik-photoview-container">
        <div class="row ajapaik-no-left-margin-row">
            <div class="col-xs-10">
                {% if rephoto %}
                    <div class="row">
                        <div class="col-xs-6">
                            <div id="ajapaik-photoview-main-photo-container">
                                <a class="fullscreen" rel="{{ photo.id }}" href="{{ photo.get_absolute_url }}">
                                    <img id="ajapaik-photoview-main-photo" class="img-responsive {% if photo.flip %}flip-photo{% endif %}" src="{% url 'project.home.views.photo_large' photo.id %}"/>
                                </a>
                                <button class="btn btn-default ajapaik-overlay-button ajapaik-flip-photo-overlay-button" style="display: none;"></button>
                            </div>
                            {% if photo.description %}
                                <div class="row ajapaik-no-left-margin-row">
                                    <p>{{ photo.description }}</p>
                                </div>
                            {% endif %}
                            <div class="row ajapaik-no-left-margin-row">
                                <div class="col-xs-12">
                                    {% if photo.source_url %}
                                        <div class="row">
                                            <a onclick="window._gaq.push(['_trackEvent', 'Photoview', 'Source link click']);"
                                               href='{{ photo.source_url }}' target="_blank">
                                                {{ photo.source.description }}{% if photo.source_key %}
                                                    {{ photo.source_key }}{% endif %}
                                            </a>
                                        </div>
                                    {% elif photo.source.description %}
                                        <div class="row">
                                            {{ photo.source.description }}{% if photo.source_key %}
                                                {{ photo.source_key }}{% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-xs-6">
                                    {% if photo.rephotos.0 %}
                                        <p>{{ photo.rephotos.all.0.user.fb_name }}}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div id="ajapaik-photoview-rephoto-container">
                                <a class="fullscreen" rel="{{ rephoto.id }}" href="{{ rephoto.get_absolute_url }}">
                                    <img id="ajapaik-photoview-rephoto" class="img-responsive {% if rephoto.flip %}flip-photo{% endif %}" src="{% url 'project.home.views.photo_large' rephoto.id %}"/>
                                </a>
                            </div>
                            <div class="row ajapaik-no-left-margin-row">
                                {% trans "Rephotograph by" %}&nbsp;<a id="ajapaik-photo-modal-rephoto-user-link" target="_blank" href="{{ rephoto.user.fb_link }}">{{ rephoto.user.fb_name }}</a>&nbsp;{% include '_creative_commons.html' %}
                            </div>
                            {% if rephoto.date %}
                                <div class="row ajapaik-no-left-margin-row">
                                    {% trans "Date taken" %}&nbsp;
                                    <div id="ajapaik-photoview-date-taken">{{ rephoto.date }}</div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    {% include "_comments.html" %}
                {% else %}
                    <div class="row ajapaik-no-left-margin-row">
                        <div id="ajapaik-photoview-main-photo-container">
                            <a class="fullscreen" rel="{{ photo.id }}" href="{{ photo.get_absolute_url }}">
                                <img id="ajapaik-photoview-main-photo" class="img-responsive {% if photo.flip %}flip-photo{% endif %}" src="{% url 'project.home.views.photo_large' photo.id %}"/>
                            </a>
                            <button class="btn btn-default ajapaik-overlay-button ajapaik-flip-photo-overlay-button" style="display: none;"></button>
                        </div>
                    </div>
                    {% if photo.description %}
                        <div class="row ajapaik-no-left-margin-row">
                            <p>{{ photo.description }}</p>
                        </div>
                    {% endif %}
                    <div class="row ajapaik-no-left-margin-row">
                        <div class="col-xs-6">
                            {% if photo.source_url %}
                                <div class="row">
                                    <a onclick="window._gaq.push(['_trackEvent', 'Photoview', 'Source link click']);"
                                       href='{{ photo.source_url }}' target="_blank">
                                        {{ photo.source.description }}{% if photo.source_key %}
                                            {{ photo.source_key }}{% endif %}
                                    </a>
                                </div>
                            {% elif photo.source.description %}
                                <div class="row">
                                    {{ photo.source.description }}{% if photo.source_key %}
                                        {{ photo.source_key }}{% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    {% include "_comments.html" %}
                {% endif %}
            </div>
            <div class="col-xs-2">
                {% for rephoto in photo.rephotos.all %}
                    <a href="{% url 'project.home.views.photo' rephoto.id %}">
                        <img src="{% url 'project.home.views.photo_thumb' rephoto.id %}" class="img-responsive ajapaik-photoview-rephoto-thumb" />
                    </a>
                {% endfor %}
            </div>
        </div>
    </div>
    <script>
    $(document).ready(function () {
        var mainPhoto = $('#ajapaik-photoview-main-photo');
        $(document).on('click', '.ajapaik-flip-photo-overlay-button', function () {
            var $this = $(this);
            if ($this.hasClass('active')) {
                $this.removeClass('active');
            } else {
                $this.addClass('active');
            }
            if (mainPhoto.hasClass('ajapaik-photo-flipped')) {
                mainPhoto.removeClass('ajapaik-photo-flipped');
            } else {
                mainPhoto.addClass('ajapaik-photo-flipped');
            }
        });
        if (window.isMobile) {
            $('.ajapaik-flip-photo-overlay-button').show();
        }
        $(document).on('mouseover', '#ajapaik-photoview-main-photo-container', function () {
            if (!window.isMobile) {
                $('.ajapaik-flip-photo-overlay-button').show();
            }
        });
        $(document).on('mouseout', '#ajapaik-photoview-main-photo-container', function () {
            if (!window.isMobile) {
                $('.ajapaik-flip-photo-overlay-button').hide();
            }
        });
        $('#ajapaik-comment-tabs a').click(function (e) {
            e.preventDefault();
            console.log('asd');
            $(this).tab('show')
        });
    });
</script>
{% endblock %}