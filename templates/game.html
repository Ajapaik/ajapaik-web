{% extends "base_bootstrap.html" %}
{% load i18n compress %}

{% block header %}
    {% include "_header_area_selection_scoreboard.html" %}
{% endblock %}

{% block layout %}
    {% include "_tutorial.html" %}
    <div class="modal fade" id="ajapaik-game-photo-modal" tabindex="-1" role="dialog"
         aria-labelledby="ajapaik-game-photo-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" id="ajapaik-game-modal-header">
                    <button id="ajapaik-game-close-game-modal" type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body" id="ajapaik-game-modal-body">
                    <div id="ajapaik-game-modal-photo-container">
                        <a class="fullscreen col-xs-12" id="ajapaik-game-full-screen-link" rel="" href="">
                            <img src="" class="img-responsive col-xs-12" id="ajapaik-game-modal-photo"/>
                        </a>
                        <button class="btn btn-default ajapaik-overlay-button ajapaik-flip-photo-overlay-button"></button>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="row ajapaik-photo-modal-row ajapaik-no-left-margin-row ajapaik-no-right-margin-row">
                        <div id="ajapaik-game-photo-description" style="display: none;"></div>
                        <div id="ajapaik-game-photo-identifier" style="display: none;"></div>
                    </div>
                    <div class="row" style="text-align: right; margin-right: 0;">
                        <div class="col-xs-6">
                            <button class="btn btn-default btn-block pull-left ajapaik-game-show-description-button" data-toggle="popover" style="display: none;">
                                {% trans "Show description" %}
                            </button>
                        </div>
                    </div>
                    <div class="row" style="text-align: right; margin-right: 0; margin-top: 5px;">
                        <div class="col-xs-6">
                            <button class="btn btn-success btn-block ajapaik-game-specify-location-button">
                                {% trans "Pick the shooting location!" %}
                            </button>
                        </div>
                        <div class="col-xs-6">
                            <button class="btn btn-primary btn-block ajapaik-game-next-photo-button">{% trans "Next photo" %}</button>
                        </div>
                    </div>
                    <div class="row hidden-xs">
                        <div class="col-xs-12">
                            <b id="ajapaik-game-no-geotags-yet-message" class="text-left">{% trans "The picture has not yet been pinned on the map. Be the first!" %}</b>
                            <b id="ajapaik-game-one-geotag-message" class="text-left">{% trans "1 suggestion has been submitted for this picture. Add yours!" %}</b>
                            <b id="ajapaik-game-number-of-geotags-message" class="text-left"><span id="ajapaik-game-number-of-geotags"></span>&nbsp;{% trans "suggestions have been submitted for this picture. Add yours!" %}</b>
                        </div>
                    </div>
                    <p id="ajapaik-game-status-message"></p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="ajapaik-game-info-modal" tabindex="-1" role="dialog"
         aria-labelledby="ajapaik-game-info-modal-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4>{{ album.name }}</h4>
                    {% if album.description %}
                        <h6>{{ album.description }}</h6>
                    {% endif %}
                    <h6>{% trans "Album curated by" %} <a target="_blank" href="{{ album.profile.fb_link }}">{{ album.profile.fb_name }}</a></h6>
                </div>
                <div class="modal-body" id="ajapaik-game-info-modal-body">
                    <div class="row">
                        {% blocktrans count counter=total_photo_count %}
                            Album has {{ counter }} photo,
                        {% plural %}
                            Album has {{ counter }} photos,
                        {% endblocktrans %}
                        {% blocktrans count counter=geotagging_user_count %}
                            {{ counter }} user has put
                        {% plural %}
                            {{ counter }} users have put
                        {% endblocktrans %}
                        {% if total_photo_count == geotagged_photo_count %}
                            {% trans "all the pictures on the map." %}
                        {% else %}
                            {% blocktrans count counter=geotagged_photo_count %}
                                {{ counter }} picture on the map.
                            {% plural %}
                                {{ counter }} pictures on the map.
                            {% endblocktrans %}
                        {% endif %}
                    </div>
                    <div class="row">
                        {% if user_geotagged_photo_count == 0 %}
                            {% trans "You haven't made any location suggestions for pictures in this album." %}
                        {% else %}
                            {% trans "You have made a location suggestion for" %}
                            {% if user_geotagged_photo_count == total_photo_count %}
                                {% trans "all the pictures from this album." %}
                            {% else %}
                                {% blocktrans count counter=user_geotagged_photo_count %}
                                    {{ counter }} picture in this album.
                                {% plural %}
                                    {{ counter }} pictures in this album.
                                {% endblocktrans %}
                            {% endif %}
                        {% endif %}
                    </div>
                    {% if rephoto_user_count > 0 %}
                        {% if rephoto_user_count != 1 and user_rephoto_count > 0 %}
                            <div class="row">
                                {% blocktrans count counter=rephoto_user_count %}
                                    {{ counter }} user has made
                                {% plural %}
                                    {{ counter }} users have made
                                {% endblocktrans %}
                                {% blocktrans count counter=rephoto_count %}
                                    {{ counter }} rephotograph
                                {% plural %}
                                    {{ counter }} rephotographs
                                {% endblocktrans %}
                                {% blocktrans count counter=rephotographed_photo_count %}
                                    for {{ counter }} picture in the album.
                                {% plural %}
                                    for {{ counter }} picture in the album.
                                {% endblocktrans %}
                            </div>
                        {% endif %}
                    {% endif %}
                    {% if user_rephoto_count > 0 %}
                        <div class="row">
                            {% blocktrans count counter=user_rephoto_count %}
                                You have made {{ counter }} rephoto
                            {% plural %}
                                You have made {{ counter }} rephotos
                            {% endblocktrans %}
                            {% blocktrans count counter=user_rephotographed_photo_count %}
                                for {{ counter }} picture in the album.
                            {% plural %}
                                for {{ counter }} picures in the album.
                            {% endblocktrans %}
                        </div>
                    {% endif %}
                    <br>
                    {% if nearby_albums %}
                        <div class="row">
                            {% trans "Some nearby albums" %}: {% for a in nearby_albums %}
                                <a href="{% url 'project.home.views.game' %}?album={{ a.id }}">{{ a.name }}</a>{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button id="ajapaik-sharing-dropdown-button" class="btn btn-block btn-primary ajapaik-photo-modal-share-button pull-left" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {% trans "Share" %}
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="ajapaik-sharing-dropdown-button">
                        <li role="presentation" class="disabled-link">
                            <a role="menuitem" tabindex="-1" id="ajapaik-grab-link">
                                <input type="text" class="form-control" value="{{ share_link }}?album={{ album.id }}">
                            </a>
                        </li>
                        <li role="presentation">
                            <a role="menuitem" tabindex="-1">
                                <div class="fb-like" data-href="{{ share_link }}?album={{ album.id }}" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <input id="pac-input" class="controls" type="text" placeholder={% trans "Search box" %}>
    <div id="ajapaik-map-container">
        <div id="ajapaik-map-canvas"></div>
        <div id="ajapaik-guess-panel-container-xs" class="container-fluid visible-xs">
            {% include "_guess_panel_xs.html" %}
        </div>
    </div>
    <div id="ajapaik-guess-panel-container" class="container">
        {% include "_guess_panel.html" %}
    </div>
    <div class="full-box">
        <div class="full-pic" id="ajapaik-fullscreen-image-container">
            <img id="ajapaik-full-screen-image" src=""/>
            <button id="ajapaik-game-full-screen-flip-button" class="btn btn-primary ajapaik-overlay-button ajapaik-flip-photo-overlay-button"></button>
            <div id="ajapaik-game-full-screen-button-container">
                <div class="row">
                    <button class="btn btn-success ajapaik-game-specify-location-button">
                        {% trans "Pick the shooting location!" %}
                    </button>
                </div>
                <div class="row">
                    <button class="btn btn-primary ajapaik-game-next-photo-button">{% trans "Next photo" %}</button>
                </div>
            </div>
            <button id="ajapaik-game-full-screen-show-description-button" class="btn btn-default ajapaik-game-show-description-button" style="display: none;">{% trans "Show description" %}</button>
            <div id="ajapaik-game-full-screen-description" style="display: none;"></div>
        </div>
    </div>
    <div class="modal fade" id="ajapaik-full-leaderboard-modal" tabindex="-1" role="dialog"
         aria-labelledby="ajapaik-full-leaderboard-modal-label" aria-hidden="true">
        <div class="modal-dialog" style="width: 75%;">
            <div class="modal-content">
                <div class="modal-body">
                    <div id="leaderboard_browser">
                        <div class="single">
                            <div class="score_container">
                                <ul class="scoreboard"></ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Close" %}</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block specific_js %}
    <script>
        var leaderboardFullURL = '{% url 'project.home.views.top50' %}',
            permalinkURL = '{{ hostname }}/foto/',
            areaId = '{{ area.id|safe }}',
            albumId = '{{ album.id|safe }}';
        {% if random_album_photo %}
            {% if random_album_photo.lat and random_album_photo.lon %}
                start_location = [{{ random_album_photo.lon|safe }}, {{ random_album_photo.lat|safe }}];
            {% else %}
                start_location = [{{ random_album_photo.area.lon|safe }}, {{ random_album_photo.area.lat|safe }}];
            {% endif %}
        {% elif area %}
            start_location = [{{ area.lon|safe }}, {{ area.lat|safe }}];
        {% else %}
            start_location = [26, 59];
        {% endif %}
    </script>
    {% compress js %}
        <script src="{{ STATIC_URL }}js/ajapaik-keyboard-control.min.js"></script>
        <script src="{{ STATIC_URL }}js/ajapaik-common.js"></script>
        <script src="{{ STATIC_URL }}libs/jsPanel-2.3.0/source/jquery.jspanel.min.js"></script>
        <script src="{{ STATIC_URL }}js/game.js"></script>
    {% endcompress %}
{% endblock %}