{% extends "base.html" %}
{% load i18n %}

{% block layout %}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/justifiedGallery.min.css" />
    <script>var cityId = {{ city_id | safe }}; var end = 200;</script>
    <div id="gallery">
        {% for photo in data %}
            <a href="{{ photo.1 }}">
                <img alt="{{ photo.0 }}" src="{{ photo.1 }}" width="{{ photo.2 }}" height="{{ photo.3 }}"/>
            </a>
        {% endfor %}
    </div>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.justifiedGallery-3.4.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#gallery').justifiedGallery({
                rowHeight: 120,
                waitThumbnailsLoad: false,
                margins: 3,
                sizeRangeSuffixes: {
                    'lt100': '',
                    'lt240': '',
                    'lt320': '',
                    'lt500': '',
                    'lt640': '',
                    'lt1024': ''
                }});
            $.ajaxSetup({
                headers: { 'X-CSRFToken': docCookies.getItem('csrftoken') }
            });
          $(window).scroll(function() {
             if($(window).scrollTop() + $(window).height() == $(document).height()) {
                $.ajax({
                    cache: false,
                    url: '/grid_infinity/' + cityId + '/' + end + '/',
                    success: function (result) {
                        for (var i = 0; i < result.length; i += 1) {
                            var newA = document.createElement("a");
                            var newImg = document.createElement("img");
                            $(newImg).attr("src", result[i][1]).attr("width", result[i][2]).attr("height", result[i][3]);
                            newA.appendChild(newImg);
                            $("#gallery").append(newA);
                        }
                        end += 100;
                        $('#gallery').justifiedGallery('norewind');
                    }
                });

             }
          });
        });
    </script>
{% endblock layout %}