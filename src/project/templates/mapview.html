{% extends "base.html" %}
{% load i18n %}

{% block layout %}
<div id="content" class="clearfix map" style="width:100%; height:100%">
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript">
        var map;
        function initialize() {
            // Starting point
        	var latlng = new google.maps.LatLng(59.437,24.76);
            
            // New base layer
            var osmMapType = new google.maps.ImageMapType({
            	getTileUrl: function(coord, zoom) {
            		return "http://tile.openstreetmap.org/" +
            		zoom + "/" + coord.x + "/" + coord.y + ".png";
            	},
            	tileSize: new google.maps.Size(256, 256),
            	isPng: true,
            	alt: "OpenStreetMap layer",
            	name: "OpenStreetMap",
            	maxZoom: 19
            });
        	
        	var mapOpts = {
        		zoom: 14,
        		center: latlng,
                mapTypeId: 'OSM',
                mapTypeControlOptions: {
                	  mapTypeIds: ['OSM', google.maps.MapTypeId.ROADMAP],
                	  style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
                }
        		
        	};
        	
        	map = new google.maps.Map(document.getElementById("map_canvas"), mapOpts);
        	map.setCenter(latlng);
        	map.setZoom(14);
        	
        	// Attach base layer
        	map.mapTypes.set('OSM', osmMapType);
        	map.setMapTypeId('OSM');
        
        	var geotagged_photos={{ json_data }};
        
        	for (var i in geotagged_photos) {
        		var p=geotagged_photos[i];
        		var marker = new google.maps.Marker({map: map,
        				position: new google.maps.LatLng(p[2],p[1]), 
        				zIndex: p[3] ? 1 : 0,
        				icon:'/media/images/' + (p[3] ? 'icon_camera_hot.png' : 'icon_camera.png')});
                
                (function(id) {
                google.maps.event.addListener(marker, 'click', function() {
                    $.ajax({
                        cache: false,
                        url: '/foto/'+id+'/',
                        success: function(result) {
                            $.fancybox({
                                content: result,
                                overlayColor: '#fff',
                                overlayOpacity: .7
                            });
                        }
                    });
                });
                })(p[0]);
            }
        };
        $(document).ready(initialize);
    </script>
    <div id="map_canvas" style="width:100%; height:100%"></div>
</div>
{% endblock layout %}
