{% extends "base.html" %}
{% load i18n %}

{% block layout %}
    <script type="text/javascript">
        var map;
        function initialize() {
            // Will load the base map layer and return it
            {% if city %}
            map = get_map([{{ city.lon }}, {{ city.lat }}]);
            {% else %}
            map = get_map();
            {% endif %}

        	var geotagged_photos={{ json_data }};
        
/*         var markers = []; */
        	for (var i in geotagged_photos) {
        		var p=geotagged_photos[i];
        		var marker = new google.maps.Marker({map: map,
        				position: new google.maps.LatLng(p[2],p[1]), 
        				zIndex: p[3] ? 1 : 0,
        				icon:'/media/images/' + (p[3] ? 'icon_camera_hot.png' : 'icon_camera.png')});
                
                (function(id) {
                google.maps.event.addListener(marker, 'click', function() {
    				loadPhoto(id);
                });
                })(p[0]);
            
/*             markers.push(marker); */
            }
/*         var markerCluster = new MarkerClusterer(map, markers); */
    };
    $(document).ready(initialize);
</script>

<div id="browse">

	<div class="top">

		<h1 class="ir"><a href="/?city={{city_select_form.cleaned_data.city}}">Ajapaik</a></h1>

		<ul id="nav"></ul>
        
        <div id="city_select">
            {{ city_select_form.as_p }}
            <script type="text/javascript">
                $('#id_city').change(function() {
                    location.href = '{{ request.path }}?city=' + $(this).val();
                });
            </script>
        </div>
	</div>

	<div id="photo-drawer">
	</div>

	<div class="map">
		<div id="map_canvas" style="width: 100%; height: 100%"></div>
	</div>

</div>

<script type="text/javascript" src="{{ MEDIA_URL }}js/browse.js"></script>

{% endblock layout %}
