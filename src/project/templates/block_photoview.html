{% load thumbnail %}
{% load i18n %}

<div class="photos clearfix">

	<a href="#" id="close-photo-drawer" class="btn small">{% trans "Close photo" %}</a>

	<div class="original photo-item">
		{% thumbnail photo.image "700x400" as im %}
		<a href="{{ photo.get_absolute_url }}"><img src="{{ im.url }}" border="0" /></a>
		{% endthumbnail %}
		
		<div class="tools">
			<div class="description">
				<p>{{ photo.description }}</p>
				<p class="owner">{{ photo.source.name }}</p>
			</div>
		</div>
	</div>

	{% thumbnail photo.rephotos.all.0.image "700x400" as rephoto %}

	<div class="rephoto photo-item">
		<div class="container">
			<div class="meta">
				<div class="content" id="meta_content">
					{% if photo.rephotos.all.0.user.fb_name %}{{ photo.rephotos.all.0.user.fb_name }}{% endif %}
				</div>
			</div>
			<!-- <a href="#" class="info">Info</a> -->

			<img id="rephoto_img" src="{{ rephoto.url }}" />
		</div>

		<div class="tools">
			<ul class="thumbs">
				<li><a href="#" class="add-rephoto btn small">{% trans "Add rephoto" %}</a></li>

				{% for rephoto in photo.rephotos.all %}
				<li class="photo"><a href="#" rel="{% thumbnail rephoto.image "700x400" as image %}{{ image.url }}{% endthumbnail %}" title="{% if rephoto.user.fb_name %}{{ rephoto.user.fb_name }}{% endif %}"><img src="{% thumbnail rephoto.image "50x50" crop="center" as thumb %}{{ thumb.url }}{% endthumbnail %}" /></a></li>
				{% endfor %}
			</ul>
		</div>

	</div><!-- .rephoto -->

	{% empty %}

	<div class="no-rephoto">
		<p>{% trans "Make a contemporary rephoto from the very same place where the historic picture was taken and upload it." %}</p>

		<p class="add-rephoto-container">
			<a href="#" class="add-rephoto btn small">{% trans "Add rephoto" %}</a>
		</p>

		<script>
			$('#photo-drawer .original img').load(function() {
				$('.no-rephoto').css('width', $(this).css('width') );
			});
		</script>
	</div>

	{% endthumbnail %}

</div>
{% comment %}
<fb:comments href="{{ hostname }}{{ photo.get_detail_url }}" num_posts="3" width="500"></fb:comments>
{% endcomment %}



<div id="notice-container" style="display: none">

	<div id="notice" style="width: 400px;">
		<script src="{{ MEDIA_URL }}js/jquery.html5_upload.js" type="text/javascript"></script>
		<script type="text/javascript">
        $(function() {
            $("#upload_field").html5_upload({
                autostart: true,
                stopOnFirstError: false,
                url: function(number) {
                    return '{% url views.photo_upload photo.pk %}';
                    //return prompt(number + " url", "/");
                },
                onBrowserIncompatible: function() {
                    $("#upload_field").attr('disabled', 'disabled');
                },
                sendBoundary: window.FormData || $.browser.mozilla,
                onStart: function(event, total) {
                    return confirm(interpolate(ngettext('You have selected %s file for uploading. Continue?', 'You have selected %s files for uploading. Continue?'), [total]));
                },
                setName: function(text) {
                    $("#progress_report_name").text(text);
                },
                setStatus: function(text) {
                    $("#progress_report_status").text(text);
                },
                setProgress: function(val) {
                    $("#progress_report_bar").css('width', Math.ceil(val*100)+"%");
                },
                onFinish: function(event, response, name, number, total) {
                    uploadCompleted();
                }
            });
        });
		</script>

		<p>{% trans "Make a contemporary rephoto from the very same place where the historic picture was taken and upload it." %}</p>

		{% if request.user.is_authenticated and request.user.get_profile.fb_id %}
			{% with profile=request.user.get_profile user=request.user %}
			<p>{% blocktrans with link_open="<a href='/logout'>" link_close="</a>" account_name=user.get_full_name %}Account ({{ account_name }}) connected with Facebook. If it's not you then {{ link_open }}click here{{ link_close }}.{% endblocktrans %}</p>
			<!--
			<a href="#" id="upload" class="btn green" onclick="$('#upload_field').click(); return false;">Vali pildifail</a>
			-->
			<input type="file" multiple="multiple" id="upload_field" />
			<!--<input type="button" id="upload_btn" value="Lae Ã¼les" onclick="$('#upload_field').trigger('html5_upload.start');" />-->
			<div id="progress_report">
				<div id="progress_report_name"></div>
				<div id="progress_report_status" style="font-style: italic;"></div>
				<div id="progress_report_bar_container" style="width: 90%; height: 5px;">
					<div id="progress_report_bar" style="background-color: blue; width: 0; height: 100%;"></div>
				</div>
			</div>
			{% endwith %}
		{% else %}
			<div id="facebook-connect">
				<p>{% trans "Rephoto uploading requires connecting your account with Facebook." %}</p>
				<a href="/facebook/login" class="ir">{% trans "Connect with Facebook" %}</a>
			</div>
		{% endif %}

		<p></p>
		<a href="javascript:void(0);" onclick="uploadCompleted();">{% trans "Close" %}</a>

	</div>

	<div id="uploadCompleted" class="notice">
		<h2>{% trans "Thank you!" %}</h2>

		<p>{% trans "Your file has been uploaded." %}</p>
	</div>
</div>
