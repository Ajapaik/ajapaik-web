{% extends "layouts/slim.html" %}
{% load thumbnail i18n %}

{% block content %}
    <script type="text/javascript">
        var city_id = '{{ city.id }}',
            heatmap,
            heatmapPoints = {{ json_data|safe }},
            pointArray,
            taxiData = [],
            i,
            marker;

        function initialize() {
            {% if photo_lon and photo_lat %}
                getMap([{{ photo_lon }}, {{ photo_lat }}], 15);
            {% else %}
                {% if city and city.lon and city.lat %}
                    getMap([{{ city.lon }}, {{ city.lat }}], 13);
                {% else %}
                    getMap();
                {% endif %}
            {% endif %}

            for (i in heatmapPoints) {
                if (heatmapPoints.hasOwnProperty(i)) {
                    taxiData.push(new google.maps.LatLng(heatmapPoints[i][1], heatmapPoints[i][0]));
                }
            }

            pointArray = new google.maps.MVCArray(taxiData);

            heatmap = new google.maps.visualization.HeatmapLayer({
                data: pointArray
            });
            heatmap.setOptions({radius: 50, dissipating: true});
            heatmap.setMap(window.map);

            {% if photo_lon and photo_lat %}
                window.map.scrollwheel = true;
                marker = new google.maps.Marker({
                    map: window.map,
                    draggable: false,
                    position: new google.maps.LatLng({{ photo_lat }}, {{ photo_lon }}),
                    icon: "/media/gfx/ajapaik_marker_45px.png"
                });
            {% endif %}
        }
        $(document).ready(initialize);
    </script>

    <div id="game">
        <div id="top"></div>
        <div id="tools" style="left:0; width:100%; display:block;">
            <div id="map_canvas" style="width:100%; height:100%; display:block;"></div>
        </div>
        <div id="btm"></div>
    </div>
{% endblock %}